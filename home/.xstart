#!/bin/bash
set_escape_key() {
    xmodmap -e 'clear Lock' -e 'keycode 0x42 = Escape'
}

main() {
    echo "Starting new session..."
    source /etc/X11/xinit/xinitrc.d/30-dbus.sh
    source ~/.bash_profile

    twmnd &

    xbindkeys &
    (set_escape_key && sleep 5 && set_escape_key) &  # help, why does it only work like this
    set_wallpaper &

    source ~/.xstart_$(hostname)

    statusbar right &
    sleep 3

    trayer --edge top --widthtype request --align center --SetDockType true --SetPartialStrut true --expand true --transparent true --alpha 0 --tint 0x000000 --height 16 &

    xmonad # if xmonad exits, everything will be killed
}
